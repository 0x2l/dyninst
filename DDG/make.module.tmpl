# 
# Common makefile template for the dyninstAPI library.  This file is not
# intended to be a useful Makefile in isolation; instead, it should be
# included from within an architecture-specific Makefile.
#
# $Id: make.module.tmpl,v 1.4 2008/09/15 17:38:17 jaw Exp $
#

SUITE_NAME	= Dyninst
RELEASE_NUM	= 5.2
#BUILD_MARK should be (re-)defined in core/make.config.local rather than here!


CFLAGS		     += $(USEFULWARNINGS) $(DEFINES) -I../../instructionAPI/h
CXXFLAGS	     += $(USEFULWARNINGS) $(DEFINES) -I../../instructionAPI/h

LDFLAGS += -lcommon

LDFLAGS     += $(LIBDIR)
ifndef USES_NATIVE_CC
LD		= $(GXX)
LDFLAGS		+= -shared $(G_PTHREAD_LD)
CFLAGS		+= -fPIC
CXXFLAGS	+= -fPIC $(G_PTHREAD)
else
ifeq (solaris,$(findstring solaris,$(PLATFORM)))
LDFLAGS		+= -G
endif #sparc
endif #USES_NATIVE


TO_INC   = ../h

#PUBLIC_H = 

SRCS +=	../src/Graph.C \
        ../src/Edge.C \
        ../src/Node.C \
        ../src/Absloc.C \
        ../src/intraFunctionCreator.C


ifndef USES_NATIVE_CC
ifdef CROSSCOMPILER
SYSLIBS		+= -liberty -lg++ -lstdc++ -lm
else
SYSLIBS         += -liberty
endif
else
SYSLIBS		+= -ldemangle
endif


IFLAGS       += -I../$(PLATFORM) -I../src -I../h -I../../dynutil/h -I../../symtabAPI/h -I../external

DOCDIR	= ../doc


# All that, and we finally get a target...
all: $(TARGET) $(EXTRA_LIBS)


docs:
	cd ..; doxygen instructionAPI.conf
	cd $(DOCDIR)/latex; manual-preproc.pl *.tex; $(MAKE) clean
	$(MAKE) -C $(DOCDIR)/latex



