{\ttfamily \raggedright \small
001 using\ \textbf{namespace}\ Dyninst;\\
002 using\ \textbf{namespace}\ DepGraphAPI;\\
003 \ \\
004 \textsl{//\ Assume\ these\ represent\ a\ function\ and\ block\ of\ interest}\\
005 BPatch\underline\ function\ $\ast$func;\\
006 BPatch\underline\ basicBlock\ $\ast$block;\\
007 \ \\
008 \textsl{//\ Access\ the\ DDG}\\
009 DDG::Ptr\ ddg\ =\ DDG::analyze(func);\\
010 \ \\
011 \textsl{//\ Get\ the\ list\ of\ instructions\ (and\ their\ addresses)\ from\ the\ block}\\
012 \ \\
013 \textbf{typedef}\ std::pair<{}InstructionAPI::Instruction,\ Address>{}\ InsnInstance;\\
014 std::vector<{}InsnInstance>{}\ insnInstances;\\
015 block-{}>{}getInstructions(insnInstances);\\
016 \ \\
017 \textsl{//\ For\ each\ instruction,\ look\ up\ the\ DDG\ node\ and\ see\ if\ it\ has\ itself\ as\ a\ target}\\
018 \textbf{for}\ (std::vector<{}InsnInstance>{}::iterator\ iter\ =\ insnInstances.begin();\\
019 \ \ \ \ \ iter\ !=\ insnInstances.end();\ iter++)\ \{\\
020 \ \ Address\ addr\ =\ iter-{}>{}second;\\
021 \ \ \\
022 \ \ \ \ NodeIterator\ nodeBegin,\ nodeEnd;\\
023 \ \ ddg-{}>{}find(addr,\ nodeBegin,\ nodeEnd);\\
024 \ \ \textbf{for}\ (;\ nodeBegin\ !=\ nodeEnd;\ nodeBegin++)\ \{\\
025 \ \ \ \ NodeIterator\ targetBegin,\ targetEnd;\\
026 \ \ \ \ ($\ast$nodeBegin)-{}>{}getTargets(targetBegin,\ targetEnd);\\
027 \ \ \ \ \textbf{for}\ (;\ targetBegin\ !=\ targetEnd;\ targetBegin++)\ \{\\
028 \ \ \ \ \ \ \textbf{if}\ ($\ast$targetBegin\ ==\ $\ast$nodeBegin)\ \{\\
029 \ \ \ \ \ \ \ \ \textsl{//\ Found\ a\ node\ that\ has\ itself\ as\ a\ target}\\
030 \ \ \ \ \ \ \ \ actOnSelfDefiningNode($\ast$nodeBegin);\\
031 \ \ \ \ \ \ \}\\
032 \ \ \ \ \}\\
033 \ \ \}\\
034 \}\\
035 \ \\
036  }
\normalfont\normalsize

